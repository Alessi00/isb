machine:
  timezone:
    America/Los_Angeles
  environment:
    PYTHONPATH: /home/ubuntu/${CIRCLE_PROJECT_REPONAME}:/home/ubuntu/${CIRCLE_PROJECT_REPONAME}/lib
  python:
    version: 2.7.10
dependencies:
  override:
    - sudo -E /bin/sh ./shell/install-deps.sh
database:
  post:
    - mysql -u ubuntu -e "USE mysql; SET PASSWORD FOR 'ubuntu'@'localhost' = PASSWORD('isb')"
    - sudo -E /bin/sh ./shell/database-setup.sh
deployment:
  staging:
    branch: [BlinkUX-blink-pr]
    commands:
      - sudo -E rm -rf ./lib
      - sudo -E /bin/sh ./shell/gcloud_authenticate.sh
      - sudo -E /bin/sh ./shell/gcloud-pull-staging-files.sh
      - sudo -E ./google_appengine/appcfg.py -A isb-cgc update . --noauth_local_webserver
      - sudo -E ./google_appengine/appcfg.py -A isb-cgc update_cron . --noauth_local_webserver
      - sudo -E ./google_appengine/appcfg.py -A isb-cgc update_queues . --noauth_local_webserver
